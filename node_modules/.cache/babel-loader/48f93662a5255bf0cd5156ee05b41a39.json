{"ast":null,"code":"import _regeneratorRuntime from\"C:/inrich.peter/flip-book-react-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"C:/inrich.peter/flip-book-react-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"C:/inrich.peter/flip-book-react-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/inrich.peter/flip-book-react-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";var _this=this;import React,{useState,useEffect}from\"react\";import{easeInOut}from\"../helper\";import{Subscribe}from\"unstated\";import FlipBookContainer from\"../Stores/Flipbook\";import{_canFlipLeft,_canFlipRight,_polygonArray,_polygonBgSize,_polygonHeight,_polygonWidth}from'../computed';import\"./Styles.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Flipbook=function Flipbook(_ref){var _ref$flipDuration=_ref.flipDuration,flipDuration=_ref$flipDuration===void 0?1000:_ref$flipDuration,_ref$spaceTop=_ref.spaceTop,spaceTop=_ref$spaceTop===void 0?0:_ref$spaceTop;var flipInit={progress:0,direction:null,frontImage:null,backImage:null,auto:false};var _FlipBookContainer$st=FlipBookContainer.state,pageWidth=_FlipBookContainer$st.pageWidth,pageHeight=_FlipBookContainer$st.pageHeight,pages=_FlipBookContainer$st.pages,leftPage=_FlipBookContainer$st.leftPage,rightPage=_FlipBookContainer$st.rightPage;var _useState=useState(pages.length),_useState2=_slicedToArray(_useState,2),nPages=_useState2[0],setNPages=_useState2[1];var _useState3=useState(1),_useState4=_slicedToArray(_useState3,2),displayedPages=_useState4[0],setDisplayedPages=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),nImageLoad=_useState6[0],setNImageLoad=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),nImageLoadTrigger=_useState8[0],setNImageLoadTrigger=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),imageLoadCallback=_useState10[0],setImageLoadCallback=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),currentPage=_useState12[0],setCurrentPage=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),touchStartX=_useState14[0],setTouchStartX=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),touchStartY=_useState16[0],setTouchStartY=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),hasPointerEvents=_useState18[0],setHasPointerEvents=_useState18[1];var _useState19=useState(Infinity),_useState20=_slicedToArray(_useState19,2),minX=_useState20[0],setMinX=_useState20[1];var _useState21=useState(-Infinity),_useState22=_slicedToArray(_useState21,2),maxX=_useState22[0],setMaxX=_useState22[1];var _useState23=useState({}),_useState24=_slicedToArray(_useState23,2),preloadedImages=_useState24[0],setPreloadedImages=_useState24[1];var _useState25=useState(flipInit),_useState26=_slicedToArray(_useState25,2),flip=_useState26[0],setFlip=_useState26[1];var _useState27=useState(0),_useState28=_slicedToArray(_useState27,2),xMargin=_useState28[0],setXMargin=_useState28[1];// this.pageWidth * 2 - this.pageWidth * this.displayedPages) / 2\n// computed\nvar canFlipLeft=_canFlipLeft(flip,currentPage,displayedPages,leftPage,pages);var canFlipRight=_canFlipRight(flip,currentPage,nPages,displayedPages);var polygonArray=_polygonArray(flip,displayedPages,pageWidth,xMargin,spaceTop,minX,maxX,setMinX,setMaxX);var polygonBgSize=_polygonBgSize(pageWidth,pageHeight);var polygonWidth=_polygonWidth(pageWidth);var polygonHeight=_polygonHeight(pageHeight);useEffect(function(){onResize();preloadImages();},[]);useEffect(function(){FlipBookContainer.setState({leftPage:currentPage,rightPage:currentPage+1});preloadImages();},[currentPage]);// method\nvar onResize=function onResize(){setDisplayedPages(pageWidth*2>pageHeight?2:1);};var logEvery=function logEvery(){console.log({currentPage:currentPage,displayedPages:displayedPages,flip:flip,hasPointerEvents:hasPointerEvents,imageLoadCallback:imageLoadCallback,leftPage:leftPage,maxX:maxX,minX:minX,nImageLoad:nImageLoad,nImageLoadTrigger:nImageLoadTrigger,nPages:nPages,pageHeight:pageHeight,pageWidth:pageWidth,preloadedImages:preloadImages,rightPage:rightPage,touchStartX:touchStartX,touchStartY:touchStartY,canFlipLeft:canFlipLeft,canFlipRight:canFlipRight,polygonArray:polygonArray,polygonBgSize:polygonBgSize,polygonWidth:polygonWidth,polygonHeight:polygonHeight});};var pageUrl=function pageUrl(page){if(!pages[page])return null;// if (!pages[page].url) return default\nreturn pages[page].url||null;};var flipStart=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(direction,auto){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(direction==='left'){if(displayedPages===1){setFlip(_objectSpread(_objectSpread({},flip),{},{direction:direction,frontImage:pageUrl(currentPage-1),backImage:null}));}else{setFlip(_objectSpread(_objectSpread({},flip),{},{direction:direction,frontImage:pageUrl(leftPage),backImage:pageUrl(currentPage-displayedPages+1)}));}}else{if(displayedPages===1){setFlip(_objectSpread(_objectSpread({},flip),{},{direction:direction,frontImage:pageUrl(currentPage),backImage:null}));}else{setFlip(_objectSpread(_objectSpread({},flip),{},{direction:direction,frontImage:pageUrl(rightPage),backImage:pageUrl(currentPage+displayedPages)}));}}return _context.abrupt(\"return\",requestAnimationFrame(function(){return requestAnimationFrame(function(){if(direction==='left'){if(displayedPages===2){FlipBookContainer.setState({leftPage:currentPage-displayedPages});}}else{if(displayedPages===1){FlipBookContainer.setState({leftPage:currentPage+displayedPages});}else{FlipBookContainer.setState({rightPage:currentPage+1+displayedPages});}}if(auto){return flipAuto(true);}});}));case 2:case\"end\":return _context.stop();}}},_callee);}));return function flipStart(_x,_x2){return _ref2.apply(this,arguments);};}();var flipAuto=function flipAuto(ease){var _animate,duration,startRatio,t0;t0=Date.now();duration=flipDuration*(1-flip.progress);startRatio=flip.progress;setFlip(_objectSpread(_objectSpread({},flip),{},{auto:true}));_animate=function animate(){return requestAnimationFrame(function(){var ratio,t;t=Date.now()-t0;ratio=startRatio+t/duration;if(ratio>1){ratio=1;}setFlip(_objectSpread(_objectSpread({},flip),{},{progress:ease?easeInOut(ratio):ratio}));if(ratio<1){return _animate();}else{if(flip.direction==='left'){setCurrentPage(currentPage-displayedPages);}else{setCurrentPage(currentPage+displayedPages);}if(displayedPages===1&&flip.direction==='right'){setFlip(_objectSpread(_objectSpread({},flip),{},{direction:null}));}else{onImageLoad(1,function(){console.log('callback here');setFlip(_objectSpread(_objectSpread({},flip),{},{direction:null,auto:false,progress:0}));});}}});};return _animate();};var flipRevert=function flipRevert(){var _animate2,duration,startRatio,t0;t0=Date.now();duration=flipDuration*flip.progress;startRatio=flip.progress;setFlip(_objectSpread(_objectSpread({},flip),{},{auto:true}));_animate2=function animate(){return requestAnimationFrame(function(){var ratio,t;t=Date.now()-t0;ratio=startRatio-startRatio*t/duration;if(ratio<0){ratio=0;}setFlip(_objectSpread(_objectSpread({},flip),{},{progress:ratio}));if(ratio>0){return _animate2();}else{FlipBookContainer.setState({leftPage:currentPage,rightPage:currentPage+1});if(displayedPages===1&&flip.direction==='left'){setFlip(_objectSpread(_objectSpread({},flip),{},{direction:null,auto:false}));}else{onImageLoad(1,function(){setFlip(_objectSpread(_objectSpread({},flip),{},{direction:null,auto:false}));});}return false;}});};return _animate2();};var onImageLoad=function onImageLoad(trigger,cb){setNImageLoad(0);setNImageLoadTrigger(trigger);setImageLoadCallback(cb);};var didLoadImage=function didLoadImage(ev){if(!imageLoadCallback){return;}imageLoadCallback();};var swipeStart=function swipeStart(touch){setTouchStartX(touch.pageX);setTouchStartY(touch.pageY);};var swipeMove=function swipeMove(touch){var x,y;if(touchStartX==null){return;}x=touch.pageX-touchStartX;y=touch.pageY-touchStartY;if(Math.abs(y)>Math.abs(x)){return;}if(x>0){if(flip.direction===null&&canFlipLeft&&x>=5){flipStart('left',false);}if(flip.direction==='left'){setFlip(_objectSpread(_objectSpread({},flip),{},{progress:x/pageWidth<1?x/pageWidth:1}));}}else{if(flip.direction===null&&canFlipRight&&x<=-5){flipStart('right',false);}if(flip.direction==='right'){setFlip(_objectSpread(_objectSpread({},flip),{},{progress:-x/pageWidth<1?-x/pageWidth:1}));}}return true;};var swipeEnd=function swipeEnd(touch){if(flip.direction!==null&&!flip.auto){if(flip.progress>1/4){flipAuto(false);}else{flipRevert();}}setTouchStartX(null);return null;};var _onMouseDown=function onMouseDown(ev){if(hasPointerEvents){return;}if(ev.which&&ev.which!==1){return;}return swipeStart(ev);};var _onMouseMove=function onMouseMove(ev){if(hasPointerEvents){return;}if(ev.which&&ev.which!==1){return;}// Ignore right-click\nreturn swipeMove(ev);};var _onMouseUp=function onMouseUp(ev){if(!hasPointerEvents){return swipeEnd(ev);}};var preloadImages=function preloadImages(){var i,img,j,ref,ref1,results,url;if(Object.keys(preloadedImages).length>=10){_this.preloadedImages={};}results=[];for(i=j=ref=currentPage-3,ref1=currentPage+3;ref<=ref1?j<=ref1:j>=ref1;i=ref<=ref1?++j:--j){url=pageUrl(i);if(url){if(!preloadedImages[url]){img=new Image();img.src=url;results.push(preloadedImages[url]=img);}else{results.push(void 0);}}else{results.push(void 0);}}return results;};return/*#__PURE__*/_jsx(Subscribe,{to:[FlipBookContainer],children:function children(flipBookContainer){var _flipBookContainer$st=flipBookContainer.state,pageWidth=_flipBookContainer$st.pageWidth,pageHeight=_flipBookContainer$st.pageHeight,leftPage=_flipBookContainer$st.leftPage,rightPage=_flipBookContainer$st.rightPage;return/*#__PURE__*/_jsx(\"div\",{onMouseDown:function onMouseDown(ev){return _onMouseDown(ev);},onMouseMove:function onMouseMove(ev){return _onMouseMove(ev);},onMouseUp:function onMouseUp(ev){return _onMouseUp(ev);},style:{width:pageWidth*displayedPages+'px',height:pageHeight+'px',margin:'auto'},children:/*#__PURE__*/_jsx(\"div\",{className:\"viewport\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",style:{width:'100%'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"centering-box\",style:{width:pageWidth*displayedPages},children:[pageUrl(leftPage)&&/*#__PURE__*/_jsx(\"img\",{className:\"page fixed\",style:{width:pageWidth+'px',height:pageHeight+'px',left:xMargin+'px',top:spaceTop+'px'},src:pageUrl(leftPage),onLoad:function onLoad($event){return didLoadImage($event);}}),displayedPages===2&&pageUrl(rightPage)&&/*#__PURE__*/_jsx(\"img\",{className:\"page fixed\",style:{width:pageWidth+'px',height:pageHeight+'px',left:pageWidth+'px',top:spaceTop+'px'},src:pageUrl(rightPage),onLoad:function onLoad($event){return didLoadImage($event);}}),polygonArray.map(function(item,index){return/*#__PURE__*/_jsx(\"div\",{className:item[1]?'polygon blank':'polygon',style:{backgroundImage:item[1],backgroundSize:polygonBgSize,backgroundPosition:item[3],width:polygonWidth,height:polygonHeight,transform:item[4],zIndex:item[5]},children:item[2].length&&/*#__PURE__*/_jsx(\"div\",{className:\"lighting\",style:{backgroundImage:item[2]}})},index);})]}),/*#__PURE__*/_jsx(\"div\",{className:\"guard\"})]})})});}});};export default Flipbook;","map":{"version":3,"sources":["C:/inrich.peter/flip-book-react-master/src/components/Flipbook.js"],"names":["React","useState","useEffect","easeInOut","Subscribe","FlipBookContainer","_canFlipLeft","_canFlipRight","_polygonArray","_polygonBgSize","_polygonHeight","_polygonWidth","Flipbook","flipDuration","spaceTop","flipInit","progress","direction","frontImage","backImage","auto","state","pageWidth","pageHeight","pages","leftPage","rightPage","length","nPages","setNPages","displayedPages","setDisplayedPages","nImageLoad","setNImageLoad","nImageLoadTrigger","setNImageLoadTrigger","imageLoadCallback","setImageLoadCallback","currentPage","setCurrentPage","touchStartX","setTouchStartX","touchStartY","setTouchStartY","hasPointerEvents","setHasPointerEvents","Infinity","minX","setMinX","maxX","setMaxX","preloadedImages","setPreloadedImages","flip","setFlip","xMargin","setXMargin","canFlipLeft","canFlipRight","polygonArray","polygonBgSize","polygonWidth","polygonHeight","onResize","preloadImages","setState","logEvery","console","log","pageUrl","page","url","flipStart","requestAnimationFrame","flipAuto","ease","animate","duration","startRatio","t0","Date","now","ratio","t","onImageLoad","flipRevert","trigger","cb","didLoadImage","ev","swipeStart","touch","pageX","pageY","swipeMove","x","y","Math","abs","swipeEnd","onMouseDown","which","onMouseMove","onMouseUp","i","img","j","ref","ref1","results","Object","keys","Image","src","push","flipBookContainer","width","height","margin","left","top","$event","map","item","index","backgroundImage","backgroundSize","backgroundPosition","transform","zIndex"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\"\nimport { easeInOut } from \"../helper\"\nimport { Subscribe } from \"unstated\"\nimport FlipBookContainer from \"../Stores/Flipbook\";\nimport {\n  _canFlipLeft,\n  _canFlipRight,\n  _polygonArray,\n  _polygonBgSize,\n  _polygonHeight,\n  _polygonWidth\n} from '../computed'\nimport \"./Styles.css\"\n\nconst Flipbook = ({\n  flipDuration = 1000,\n  spaceTop = 0\n}) => {\n  const flipInit = {\n    progress: 0,\n    direction: null,\n    frontImage: null,\n    backImage: null,\n    auto: false\n  }\n\n  const {\n    pageWidth,\n    pageHeight,\n    pages,\n    leftPage,\n    rightPage\n  } = FlipBookContainer.state\n\n  const [nPages, setNPages] = useState(pages.length);\n  const [displayedPages, setDisplayedPages] = useState(1);\n  const [nImageLoad, setNImageLoad] = useState(0);\n  const [nImageLoadTrigger, setNImageLoadTrigger] = useState(0);\n  const [imageLoadCallback, setImageLoadCallback] = useState(null);\n  const [currentPage, setCurrentPage] = useState(0);\n  const [touchStartX, setTouchStartX] = useState(null);\n  const [touchStartY, setTouchStartY] = useState(null);\n  const [hasPointerEvents, setHasPointerEvents] = useState(false);\n  const [minX, setMinX] = useState(Infinity);\n  const [maxX, setMaxX] = useState(-Infinity);\n  const [preloadedImages, setPreloadedImages] = useState({});\n  const [flip, setFlip] = useState(flipInit);\n  const [xMargin, setXMargin] = useState(0) // this.pageWidth * 2 - this.pageWidth * this.displayedPages) / 2\n  // computed\n  const canFlipLeft = _canFlipLeft(flip, currentPage, displayedPages, leftPage, pages)\n  const canFlipRight = _canFlipRight(flip, currentPage, nPages, displayedPages)\n  const polygonArray = _polygonArray(flip, displayedPages, pageWidth, xMargin, spaceTop, minX, maxX, setMinX, setMaxX)\n  const polygonBgSize = _polygonBgSize(pageWidth, pageHeight)\n  const polygonWidth = _polygonWidth(pageWidth)\n  const polygonHeight = _polygonHeight(pageHeight)\n\n  useEffect(() => {\n    onResize();\n    preloadImages();\n  }, []);\n\n  useEffect(() => {\n    FlipBookContainer.setState({\n      leftPage: currentPage,\n      rightPage: currentPage + 1\n    })\n    preloadImages()\n  }, [currentPage])\n\n  // method\n  const onResize = () => {\n    setDisplayedPages(pageWidth * 2 > pageHeight ? 2 : 1)\n  }\n\n  const logEvery = () => {\n    console.log({\n      currentPage: currentPage,\n      displayedPages: displayedPages,\n      flip: flip,\n      hasPointerEvents: hasPointerEvents,\n      imageLoadCallback: imageLoadCallback,\n      leftPage: leftPage,\n      maxX: maxX,\n      minX: minX,\n      nImageLoad: nImageLoad,\n      nImageLoadTrigger: nImageLoadTrigger,\n      nPages: nPages,\n      pageHeight: pageHeight,\n      pageWidth: pageWidth,\n      preloadedImages: preloadImages,\n      rightPage: rightPage,\n      touchStartX: touchStartX,\n      touchStartY: touchStartY,\n      canFlipLeft: canFlipLeft,\n      canFlipRight: canFlipRight,\n      polygonArray: polygonArray,\n      polygonBgSize: polygonBgSize,\n      polygonWidth: polygonWidth,\n      polygonHeight: polygonHeight\n    });\n  }\n\n  const pageUrl = (page) => {\n    if (!pages[page]) return null\n    // if (!pages[page].url) return default\n    return pages[page].url || null;\n  }\n\n  const flipStart = async (direction, auto) => {\n    if (direction === 'left') {\n      if (displayedPages === 1) {\n        setFlip({\n          ...flip,\n          direction: direction,\n          frontImage: pageUrl(currentPage - 1),\n          backImage: null\n        })\n      } else {\n        setFlip({\n          ...flip,\n          direction: direction,\n          frontImage: pageUrl(leftPage),\n          backImage: pageUrl(currentPage - displayedPages + 1)\n        })\n      }\n    } else {\n      if (displayedPages === 1) {\n        setFlip({\n          ...flip,\n          direction: direction,\n          frontImage: pageUrl(currentPage),\n          backImage: null\n        })\n      } else {\n        setFlip({\n          ...flip,\n          direction: direction,\n          frontImage: pageUrl(rightPage),\n          backImage: pageUrl(currentPage + displayedPages)\n        })\n      }\n    }\n    return requestAnimationFrame(() => {\n      return requestAnimationFrame(() => {\n        if (direction === 'left') {\n          if (displayedPages === 2) {\n            FlipBookContainer.setState({\n              leftPage: currentPage - displayedPages\n            })\n          }\n        } else {\n          if (displayedPages === 1) {\n            FlipBookContainer.setState({\n              leftPage: currentPage + displayedPages\n            })\n          } else {  \n            FlipBookContainer.setState({\n              rightPage: currentPage + 1 + displayedPages\n            })\n          }\n        }\n        if (auto) {\n          return flipAuto(true);\n        }\n      });\n    });\n  }\n\n  const flipAuto = ease => {\n    var animate, duration, startRatio, t0;\n      t0 = Date.now();\n      duration = flipDuration * (1 - flip.progress);\n      startRatio = flip.progress;\n      setFlip({\n        ...flip,\n        auto: true\n      })\n      animate = () => {\n        return requestAnimationFrame(() => {\n          var ratio, t;\n          t = Date.now() - t0;\n          ratio = startRatio + t / duration;\n          if (ratio > 1) {\n            ratio = 1;\n          }\n          setFlip({\n            ...flip,\n            progress: ease ? easeInOut(ratio) : ratio\n          })\n          if (ratio < 1) {\n            return animate();\n          } else {\n            if (flip.direction === 'left') {\n              setCurrentPage(currentPage - displayedPages)\n            } else {\n              setCurrentPage(currentPage + displayedPages)\n            }\n            if (displayedPages === 1 && flip.direction === 'right') {\n              setFlip({\n                ...flip,\n                direction: null\n              })\n            } else {\n              onImageLoad(1, () => {\n                console.log('callback here');\n                setFlip({\n                  ...flip,\n                  direction: null,\n                  auto: false,\n                  progress: 0\n                })\n              });\n            }\n          }\n        });\n      };\n      return animate();\n  }\n\n  const flipRevert = () => {\n    var animate, duration, startRatio, t0;\n      t0 = Date.now();\n      duration = flipDuration * flip.progress;\n      startRatio = flip.progress;\n      setFlip({\n        ...flip,\n        auto: true\n      })\n      animate = () => {\n        return requestAnimationFrame(() => {\n          var ratio, t;\n          t = Date.now() - t0;\n          ratio = startRatio - startRatio * t / duration;\n          if (ratio < 0) {\n            ratio = 0;\n          }\n          setFlip({\n            ...flip,\n            progress: ratio\n          })\n          if (ratio > 0) {\n            return animate();\n          } else {\n            FlipBookContainer.setState({\n              leftPage: currentPage,\n              rightPage: currentPage + 1\n            })\n            if (displayedPages === 1 && flip.direction === 'left') {\n              setFlip({\n                ...flip,\n                direction: null,\n                auto: false\n              })\n            } else {\n              onImageLoad(1, () => {\n                setFlip({\n                  ...flip,\n                  direction: null,\n                  auto: false\n                })\n              });\n            }\n            return false;\n          }\n        });\n      };\n      return animate();\n  }\n\n  const onImageLoad = (trigger, cb) => {\n    setNImageLoad(0)\n    setNImageLoadTrigger(trigger)\n    setImageLoadCallback(cb)\n  }\n\n  const didLoadImage = ev => {\n    if (!imageLoadCallback) {\n      return;\n    }\n    imageLoadCallback()\n  }\n\n  const swipeStart = touch => {\n    setTouchStartX(touch.pageX);\n    setTouchStartY(touch.pageY);\n  }\n\n  const swipeMove = touch => {\n    var x, y;\n    if (touchStartX == null) {\n      return;\n    }\n    x = touch.pageX - touchStartX;\n    y = touch.pageY - touchStartY;\n    if (Math.abs(y) > Math.abs(x)) {\n      return;\n    }\n    if (x > 0) {\n      if (flip.direction === null && canFlipLeft && x >= 5) {\n        flipStart('left', false);\n      }\n      if (flip.direction === 'left') {\n        setFlip({\n          ...flip,\n          progress: x / pageWidth < 1 ? x / pageWidth : 1\n        })\n      }\n    } else {\n      if (flip.direction === null && canFlipRight && x <= -5) {\n        flipStart('right', false);\n      }\n      if (flip.direction === 'right') {\n        setFlip({\n          ...flip,\n          progress: -x / pageWidth < 1 ? -x / pageWidth : 1\n        })\n      }\n    }\n    return true;\n  }\n\n  const swipeEnd = touch => {\n    if (flip.direction !== null && !flip.auto) {\n      if (flip.progress > 1 / 4) {\n        flipAuto(false);\n      } else {\n        flipRevert();\n      }\n    }\n    setTouchStartX(null)\n    return null;\n  }\n\n  const onMouseDown = ev => {\n    if (hasPointerEvents) {\n      return;\n    }\n    if (ev.which && ev.which !== 1) {\n      return;\n    }\n    return swipeStart(ev);\n  }\n\n  const onMouseMove = ev => {\n    if (hasPointerEvents) {\n      return;\n    }\n    if (ev.which && ev.which !== 1) {\n      return;\n    } // Ignore right-click\n    return swipeMove(ev);\n  }\n\n  const onMouseUp = ev => {\n    if (!hasPointerEvents) {\n      return swipeEnd(ev)\n    }\n  }\n\n  const preloadImages = () => {\n    var i, img, j, ref, ref1, results, url;\n    if (Object.keys(preloadedImages).length >= 10) {\n      this.preloadedImages = {};\n    }\n    results = [];\n    for (i = j = ref = currentPage - 3, ref1 = currentPage + 3; (ref <= ref1 ? j <= ref1 : j >= ref1); i = ref <= ref1 ? ++j : --j) {\n      url = pageUrl(i);\n      if (url) {\n        if (!preloadedImages[url]) {\n          img = new Image();\n          img.src = url;\n          results.push(preloadedImages[url] = img);\n        } else {\n          results.push(void 0);\n        }\n      } else {\n        results.push(void 0);\n      }\n    }\n    return results;\n  };\n\n  return (\n    <Subscribe to={[FlipBookContainer]}>\n      {flipBookContainer => {\n        const {\n          pageWidth,\n          pageHeight,\n          leftPage,\n          rightPage\n        } = flipBookContainer.state\n        return (\n          <div\n            onMouseDown={ev => onMouseDown(ev)}\n            onMouseMove={ev => onMouseMove(ev)}\n            onMouseUp={ev => onMouseUp(ev)}\n            style={{\n              width: pageWidth * displayedPages + 'px',\n              height: pageHeight + 'px',\n              margin: 'auto'  \n            }}\n          >\n            <div className=\"viewport\">\n            <div className=\"container\" style={{ width: '100%' }}>\n              <div\n                className=\"centering-box\"\n                style={{ width: pageWidth * displayedPages }}\n              >\n                { pageUrl(leftPage) && <img\n                  className=\"page fixed\"\n                  style={{\n                    width: pageWidth + 'px',\n                    height: pageHeight + 'px',\n                    left: xMargin + 'px',\n                    top: spaceTop + 'px'\n                  }}\n                  src={pageUrl(leftPage)}\n                  onLoad={($event) => didLoadImage($event)}\n                />}\n                { displayedPages === 2 && pageUrl(rightPage) && <img\n                  className=\"page fixed\"\n                  style={{\n                    width: pageWidth + 'px',\n                    height: pageHeight + 'px',\n                    left: pageWidth + 'px',\n                    top: spaceTop + 'px'\n                  }}\n                  src={pageUrl(rightPage)}\n                  onLoad={($event) => didLoadImage($event)}\n                />}\n                {\n                  polygonArray.map((item, index) => {\n                    return (\n                      <div\n                      key={ index }\n                      className={ item[1] ? 'polygon blank' : 'polygon'}\n                      style={{\n                        backgroundImage: item[1],\n                        backgroundSize: polygonBgSize,\n                        backgroundPosition: item[3],\n                        width: polygonWidth,\n                        height: polygonHeight,\n                        transform: item[4],\n                        zIndex: item[5]\n                      }}\n                      >\n                      {\n                        item[2].length && <div\n                          className=\"lighting\"\n                          style={{ backgroundImage: item[2] }}\n                        />\n                      }\n                      </div>\n                    )\n                  })\n                }\n                </div>\n                <div className=\"guard\" />\n              </div>\n            </div>\n          </div>\n        );\n      }}\n    </Subscribe>\n  );\n};\n\nexport default Flipbook;\n"]},"metadata":{},"sourceType":"module"}